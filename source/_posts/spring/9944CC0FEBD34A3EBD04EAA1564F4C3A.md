---
title: å¿«é€Ÿæ­å»ºä¸€ä¸ªSpringGatewayç½‘å…³
top: false
cover: false
toc: true
mathjax: true
date: 2021-05-07 13:05:58
password:
summary:
keywords:
description:
tags:
- SpringCloud
- Gateway
categories:
- Spring
---


## â˜ï¸æ­å»ºè„šæ‰‹æ¶

æˆ‘ä»¬å¯ä»¥å» [Spring initializer](https://start.spring.io) ç½‘ç«™æˆ–è€…ç”¨ IDEA æ¥å¿«é€Ÿåˆ›å»ºå‡ºä¸€ä¸ª Spring Cloud Gateway é¡¹ç›®ã€‚

è¿™é‡Œæˆ‘ä»¬é€‰æ‹©çš„æ³¨å†Œä¸­å¿ƒæ˜¯ Zookeeperï¼Œä½ ä¹Ÿå¯ä»¥è‡ªå·±é€‰æ‹©å…¶ä»–çš„æ³¨å†Œä¸­å¿ƒæ¥æ³¨å†Œä½ çš„é¡¹ç›®ï¼Œæ¯”å¦‚é˜¿é‡Œå·´å·´çš„ Nacos ç­‰ã€‚

![%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E7%BD%91%E5%85%B3%E9%A1%B9%E7%9B%AE%20f074aa733bd04ab885cacd0c71d9f94c/Untitled.png](http://cdn.mjava.top/blog/Untitled.png)

é…ç½®å®Œç›¸å…³ä¿¡æ¯åï¼Œç‚¹å‡»ä¸‹é¢çš„ `GENERATE` æŒ‰é’®å°±å¯ä»¥å¯¼å‡ºé¡¹ç›®çš„ `zip` å‹ç¼©åŒ…ï¼Œè§£å‹åç”¨ IDE æ‰“å¼€ã€‚

æ‰“å¼€åå°±æ˜¯è¿™ä¸ªæ ·å­ï¼š

![%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E7%BD%91%E5%85%B3%E9%A1%B9%E7%9B%AE%20f074aa733bd04ab885cacd0c71d9f94c/Untitled%201.png](http://cdn.mjava.top/blog/Untitled%201.png)

## âœŒï¸é…ç½®è·¯ç”±

### Ymal æ–¹å¼é…ç½®

ä¸ºäº†æ–¹ä¾¿é…ç½®ï¼Œæˆ‘ä»¬æŠŠ `application.properties` æ”¹æˆ `application.yml` ã€‚

ç„¶åé…ç½®ä¸€ä¸ªè½¬å‘åˆ°ç™¾åº¦åˆ°è·¯ç”±ã€‚

```yaml
spring:
  cloud:
    gateway:
      routes:
        - id: route-demo
          uri: https://baidu.com
          predicates:
            - Path=/**
```

åœ¨é…ç½®ä¸­ï¼Œæˆ‘åŠ æ¥ä¸€ä¸ªè°“è¯ `Path` ï¼Œè¡¨ç¤ºæ‰€æœ‰å½“è¯·æ±‚éƒ½ä¼šåŒ¹é…åˆ°è¿™ä¸ªè·¯ç”±ä¸‹ï¼Œç„¶åè½¬å‘åˆ° `uri` é…ç½®åˆ°ç½‘å€é‡Œã€‚æ‰€ä»¥å½“æˆ‘ä»¬æ‰“å¼€æµè§ˆå™¨è®¿é—® `[http://localhost:8080/](http://localhost:8080/)` æ˜¯å°±ä¼šè‡ªåŠ¨è·³è½¬åˆ°ç™¾åº¦åˆ°é¦–é¡µã€‚

### Java ä»£ç æ–¹å¼é…ç½®

é™¤äº†ç”¨é…ç½®æ–‡ä»¶é…ç½®è·¯ç”±å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ç”¨ä»£ç çš„æ–¹å¼æ¥é…ç½®è·¯ç”±ã€‚

ä¸‹é¢æ¥å±•ç¤ºä¸€ä¸‹ä»£ç æ–¹å¼é…ç½®çš„è·¯ç”±ï¼š

```java
@Bean
public RouteLocator routesConfig(RouteLocatorBuilder builder){
	return builder.routes()
			.route("route-demo",r -> r.path("/**").uri("https://baidu.com"))
			.build();
}
```

è¿™å‡ è¡Œä»£ç å®ç°çš„æ˜¯å’Œä¸Šé¢é…ç½®ä¸€æ ·çš„åŠŸèƒ½ï¼Œå½“è®¿é—® `[http://localhost:8080/](http://localhost:8080/)` æ—¶ä¹Ÿä¼šè·³è½¬åˆ°ç™¾åº¦é¦–é¡µã€‚

## ğŸ‘Œæ³¨å†Œåˆ° Zookeeper

æ¥ä¸‹æ¥æ¼”ç¤ºä¸€ä¸‹å¦‚ä½•æŠŠç½‘å…³æ³¨å†Œåˆ° Zookeeperã€‚

é¦–å…ˆåœ¨æˆ‘ä»¬æœ¬åœ°æ­å»ºå¥½ Zookeeperï¼Œæˆ‘è¿™è¾¹æ˜¯ç›´æ¥ç”¨ Docker å¯åŠ¨äº†ä¸€ä¸ª Zookeeperã€‚

ç„¶ååœ¨é…ç½®æ–‡ä»¶æ·»åŠ å¦‚ä¸‹é…ç½®ï¼š

```yaml
spring:
  application:
    name: weidain-gateway
  cloud:
    zookeeper:
      connect-string: localhost:2181
```

ä¸Šé¢åˆ° `weidain-gateway` æ˜¯æˆ‘ä»¬æ³¨å†Œåˆ° Zookeeper ä¸Šåˆ°æœåŠ¡åï¼Œåœ°å€ `[localhost:2181](http://localhost:2181)` æ˜¯æˆ‘ä»¬æœ¬åœ° Zookeeper æ³¨å†Œä¸­å¿ƒåˆ°åœ°å€ã€‚

å¯åŠ¨é¡¹ç›®åï¼Œæˆ‘ä»¬ç”¨ Zookeeper å¯è§†åŒ–å·¥å…·å°±å¯ä»¥çœ‹åˆ°æ³¨å†Œä¸­å¿ƒå¤šäº†ä¸€ä¸ª `services`  èŠ‚ç‚¹ï¼ŒèŠ‚ç‚¹ä¸‹é¢æœ‰æˆ‘ä»¬æ³¨å†Œä¸Šå»çš„ `weidain-gateway` æœåŠ¡

![%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E7%BD%91%E5%85%B3%E9%A1%B9%E7%9B%AE%20f074aa733bd04ab885cacd0c71d9f94c/Untitled%202.png](http://cdn.mjava.top/blog/Untitled%202.png)

ä¸‹é¢å°±æ˜¯æˆ‘ä»¬ç½‘å…³æœåŠ¡æ³¨å†Œåˆ° Zookeeper åˆ°æ•°æ®ï¼š

```json
{
    "name": "weidain-gateway",
    "id": "8c802a81-12e7-4f72-9034-aee00c0745bb",
    "address": "169.254.238.114",
    "port": 8080,
    "sslPort": null,
    "payload": {
        "@class": "org.springframework.cloud.zookeeper.discovery.ZookeeperInstance",
        "id": "application-1",
        "name": "weidain-gateway",
        "metadata": {
            "instance_status": "UP"
        }
    },
    "registrationTimeUTC": 1620118042689,
    "serviceType": "DYNAMIC",
    "uriSpec": {
        "parts": [
            {
                "value": "scheme",
                "variable": true
            },
            {
                "value": "://",
                "variable": false
            },
            {
                "value": "address",
                "variable": true
            },
            {
                "value": ":",
                "variable": false
            },
            {
                "value": "port",
                "variable": true
            }
        ]
    }
}
```