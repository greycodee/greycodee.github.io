---
title: Dubboé¡¹ç›®åŒæ³¨å†Œä¸­å¿ƒ
top: false
cover: false
toc: true
mathjax: true
date: 2021-05-07 13:29:00
password:
summary:
keywords:
description:
tags:
- Dubbbo
- Spring
categories:
- Dubbo
---


## ğŸ¤”ä¸ºä»€ä¹ˆè¦åŒæ³¨å†Œä¸­å¿ƒï¼Ÿ

å½“å‰ Dubbo ç‰ˆæœ¬æ³¨å†Œç²’åº¦æ˜¯ä»¥æ¥å£ç²’åº¦æ¥æ³¨å†Œçš„ï¼Œè€Œ SpringBoot æ˜¯ä»¥æœåŠ¡ä¸ºç²’åº¦æ¥æ³¨å†Œçš„ã€‚è€Œä¸” Dubbo æœ‰è‡ªå·±çš„æ³¨å†Œä¸­å¿ƒï¼ˆå½“ç„¶ Spring Cloud Alibaba Dubbo çš„æ³¨å†Œä¸­å¿ƒå¯ä»¥æŒ‚é åœ¨ Spring ä¸Šï¼‰ã€‚æ‰€ä»¥å½“ä¸€ä¸ªé¡¹ç›®æ—¢è¦è°ƒç”¨ Dubbo æœåŠ¡ï¼Œåˆè¦æä¾›è‡ªå·±çš„ Web æ¥å£ç»™ç½‘å…³è°ƒç”¨æ—¶ï¼Œå°±è¦ä¸ºè¯¥é¡¹ç›®è®¾ç½®ä¸¤ä¸ªæ³¨å†Œä¸­å¿ƒï¼Œä¸€ä¸ª Dubboï¼Œä¸€ä¸ª SpringBootçš„ï¼ˆå½“ç„¶å¯ä»¥æ³¨å†Œåˆ°åŒä¸€ä¸ªæ³¨å†Œä¸­å¿ƒä¸Šï¼‰ã€‚

## ğŸ› ï¸åˆ›å»ºä¸€ä¸ª Dubbo æœåŠ¡æä¾›è€…

æˆ‘ä»¬å…ˆåˆ›å»ºä¸€ä¸ª Dubbo æœåŠ¡æä¾›è€…ï¼Œç„¶åæŠŠå®ƒæ³¨å†Œåˆ° Zoookeeper ä¸Šã€‚æˆ‘è¿™è¾¹ç”¨åˆ°æ˜¯ `2.7.10` ç‰ˆæœ¬åˆ° Dubboï¼Œä¸åŒ Dubbo ç‰ˆæœ¬åˆ°é…ç½®æœ‰æ‰€å·®å¼‚åŒ–ã€‚

pom ä¾èµ–ï¼š

```xml
<dependency>
      <groupId>org.apache.dubbo</groupId>
      <artifactId>dubbo-spring-boot-starter</artifactId>
      <version>2.7.10</version>
  </dependency>
  <dependency>
      <groupId>org.apache.dubbo</groupId>
      <artifactId>dubbo-dependencies-zookeeper</artifactId>
      <version>2.7.10</version>
      <type>pom</type>
  </dependency>
```

ç„¶åæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªæ¥å£ï¼Œè¿”å›ä¸€äº›æ–‡å­—ï¼Œè®°å¾—åŠ ä¸Š `@DubboService` æ³¨è§£ï¼Œè®© Dubbo åº”ç”¨å‘ç°è¿™ä¸ªæ¥å£å¹¶æ³¨å†Œåˆ°æ³¨å†Œ Zookeeper ä¸Šã€‚åŒæ—¶åœ¨å¯åŠ¨ç±»ä¸Šé¢è¿˜è¦åŠ ä¸Š `@EnableDubbo` æ³¨è§£ã€‚å½“ç„¶ä½ ä¹Ÿå¯ä»¥ç”¨é…ç½®åˆ°æ–¹å¼æ¥é…ç½®è¿™äº›ã€‚

```java
@DubboService
public class DemoServiceImpl implements DemoService {
    @Override
    public String hello() {
        return "hello! This is Dubbo's demo";
    }
}
```

å®šä¹‰å¥½æ¥å£åï¼Œæˆ‘ä»¬åœ¨é…ç½®æ–‡ä»¶åŠ ä¸Šå¦‚ä¸‹é…ç½®ï¼š

```yaml
server:
  port: 8787
dubbo:
  application:
    id: dubbo-privode
  protocol:
    name: dubbo
    port: 28808
  registry:
    address: zookeeper://localhost:2181
```

åœ¨ä¸Šé¢é…ç½®ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰æ¥é¡¹ç›®å¯åŠ¨åˆ°ç«¯å£ä¸º `8787` ï¼Œç„¶åé…ç½®äº† Dubbo çš„åè®®åç§°å’Œç«¯å£ï¼ŒåŒæ—¶ä¹Ÿé…ç½®äº†æ³¨å†Œåœ°å€ä¸ºæœ¬åœ°çš„ Zookeeper çš„åœ°å€ã€‚

é¡¹ç›®å¯åŠ¨åï¼Œæˆ‘ä»¬å°±å¯ä»¥çœ‹åˆ° Zookeeper çš„èŠ‚ç‚¹ä¸Šå¤šäº†ä¸€ä¸ª `dubbo` èŠ‚ç‚¹ï¼ŒèŠ‚ç‚¹ä¸‹é¢æœ‰æˆ‘ä»¬æ³¨å†Œä¸Šå»çš„ Dubbo æ¥å£

![Dubbo%20%E9%A1%B9%E7%9B%AE%E5%8F%8C%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83%20a2369534007b4606b16f9819157f3c3a/Untitled.png](https://cdn.jsdelivr.net/gh/greycodee/images@main/images/2021/10/08/UwzF7YUntitled.png)

## ğŸ› ï¸åˆ›å»ºä¸€ä¸ªæœåŠ¡æ¶ˆè´¹è€…

æ¶ˆè´¹è€…åŸºæœ¬å’ŒæœåŠ¡æä¾›è€…é…ç½®ç›¸åŒï¼Œåªæ˜¯è¦é¢å¤–åŠ ä¸Š web ä¾èµ–ï¼Œåº”ä¸ºæˆ‘ä»¬è¦å¯¹å¤–æä¾› HTTP æ¥å£ã€‚

```xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-web</artifactId>
</dependency>
```

ç„¶å yml é…ç½®ç¨ä½œä¿®æ”¹ï¼Œæ”¹ä¸‹ç«¯å£ä»€ä¹ˆçš„

```yaml
server:
  port: 8788
dubbo:
  application:
    id: dubbo-consumer
  protocol:
    name: dubbo
    port: 28808
  registry:
    address: zookeeper://localhost:2181
```

é…ç½®å¥½åï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå¯¹å¤–çš„ HTTP æ¥å£ï¼Œå¹¶ä¸”è°ƒç”¨ä¸Šé¢æœåŠ¡æä¾›è€…æä¾›çš„æœåŠ¡ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ç”¨æ³¨è§£ `@DubboReference` æ¥è¡¨ç¤ºæˆ‘ä»¬è¦è°ƒç”¨ Dubbo æœåŠ¡æ¥å£ã€‚

```java
@RestController
public class DubboConsumer {
    @DubboReference
    DemoService demoService;

    @GetMapping("/consumer")
    public String dubboDemo(){
        return demoService.hello();
    }
}
```

å¯åŠ¨é¡¹ç›®åï¼Œæ³¨å†Œä¸­å¿ƒå°±ä¼šå‡ºç°ä¸€ä¸ª `consumers` èŠ‚ç‚¹ï¼Œè¿™ä¸ªèŠ‚ç‚¹ä¸‹é¢æœ‰æˆ‘ä»¬æ³¨å†Œä¸Šå»æ˜¯æœåŠ¡æ¶ˆè´¹è€…ã€‚

![Dubbo%20%E9%A1%B9%E7%9B%AE%E5%8F%8C%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83%20a2369534007b4606b16f9819157f3c3a/Untitled%201.png](https://cdn.jsdelivr.net/gh/greycodee/images@main/images/2021/10/08/XuXwekUntitled%201.png)

è¿™æ—¶å€™æˆ‘ä»¬ç›´æ¥è®¿é—® `[http://localhost:8788/consumer](http://localhost:8788/consumer)` åœ°å€ï¼Œé¡µé¢å°±ä¼šå“åº” `hello! This is Dubbo's demo` å­—ç¬¦ä¸²ï¼Œè¿™æ˜¯æˆ‘ä»¬åœ¨æœåŠ¡æä¾›è€…ä¸­å®šä¹‰è¿”å›çš„æ•°æ®ï¼Œè¯´æ˜æˆ‘ä»¬æˆåŠŸè°ƒç”¨äº†æœåŠ¡æä¾›è€…æä¾›çš„ Dubbo æœåŠ¡ã€‚

## ğŸ”‘ä¸ºæ¶ˆè´¹è€…å†é…ç½®ä¸€ä¸ªæ³¨å†Œä¸­å¿ƒ

è¿™æ—¶å€™å¦‚æœæˆ‘ä»¬ç½‘å…³è¦è°ƒç”¨è¿™ä¸ªæ¶ˆè´¹è€…æä¾›çš„ HTTP æ¥å£æ€ä¹ˆåŠï¼Ÿ

ä½ å¯èƒ½ä¼šæƒ³ï¼Œå¯ä»¥ç›´æ¥æŠŠ`http://localhost:8788/consumer` è¿™ä¸ªåœ°å€é…ç½®åˆ°ç½‘å…³è·¯ç”±åˆ° `uri` å­—æ®µä¸Šã€‚ä½†æ˜¯æˆ‘ä»¬ä¸€èˆ¬é¡¹ç›®ä¸å•å•æ˜¯åªæœ‰ä¸€ä¸ªï¼Œè€Œä¸”æœ‰æ—¶å€™åœ°å€ä¹Ÿä¼šå˜åŒ–ï¼Œè¿™æ—¶å€™ç½‘å…³å°±è¦ç”¨åˆ°æœåŠ¡åæ¥è°ƒç”¨å¯¹åº”åˆ°æœåŠ¡ï¼Œç½‘å…³ä¸€èˆ¬ä»¥ `lb://service-name` æ¥è°ƒç”¨å¯¹åº”åˆ°æœåŠ¡ã€‚

å¦‚æœç½‘å…³æƒ³è¦ä»¥æœåŠ¡åæ¥è°ƒç”¨è¿™ä¸ªæ¶ˆè´¹è€…ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±è¦ä»¥æœåŠ¡ååˆ°æ–¹å¼æ¥æŠŠè¿™ä¸ªæ¶ˆè´¹è€…æ³¨å†Œåˆ° Zookeeper ä¸Šã€‚

ç”±äº Spring Cloud å®˜æ–¹å·²ç»å°† Zookeeper æ•´åˆè¿›äº† Spring Cloud ä½“ç³»ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç›´æ¥ç”¨ Spring Cloud ä¸‹çš„åŒ…ã€‚éœ€è¦æ·»åŠ å¦‚ä¸‹ä¾èµ–ï¼š

```xml
<dependencies>
	<dependency>
      <groupId>org.springframework.cloud</groupId>
      <artifactId>spring-cloud-starter-zookeeper-discovery</artifactId>
  </dependency>
</dependencies>

<dependencyManagement>
  <dependencies>
      <dependency>
          <groupId>org.springframework.cloud</groupId>
          <artifactId>spring-cloud-dependencies</artifactId>
          <version>Hoxton.SR11</version>
          <type>pom</type>
          <scope>import</scope>
      </dependency>
  </dependencies>
</dependencyManagement>
```

åŒæ—¶é…ç½®æ–‡ä»¶éœ€è¦å†æ·»åŠ å¦‚ä¸‹é…ç½®ï¼Œä¸‹é¢çš„é…ç½®ä¸­æˆ‘ä»¬æŒ‡å®šäº†è¦æ³¨å†Œåˆ° Zookeeper åˆ°æœåŠ¡å `dubbo-consumer` ,é…ç½®äº†æ³¨å†Œä¸­å¿ƒåˆ°åœ°å€ã€‚

```yaml
spring:
  application:
    name: dubbo-consumer
  cloud:
    zookeeper:
      connect-string: localhost:2181
```

åŒæ—¶å¯åŠ¨ç±»ä¹Ÿè¦åŠ ä¸Š `@EnableDiscoveryClient` æ³¨è§£ï¼Œä¸ç„¶æ˜¯ä¸ä¼šæ³¨å†Œåˆ° Zookeeper ä¸Šåˆ°ã€‚

å¯åŠ¨é¡¹ç›®åï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨ Zookeeper çš„ `services` èŠ‚ç‚¹ä¸‹é¢çœ‹åˆ°æˆ‘ä»¬çš„æœåŠ¡äº†

![Dubbo%20%E9%A1%B9%E7%9B%AE%E5%8F%8C%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83%20a2369534007b4606b16f9819157f3c3a/Untitled%202.png](https://cdn.jsdelivr.net/gh/greycodee/images@main/images/2021/10/08/ClmFp6Untitled%202.png)

åŒæ ·çš„æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ³¨å†Œä¸Šå»åˆ°æ•°æ®ï¼š

```json
{
    "name": "dubbo-consumer",
    "id": "beff8ece-85a3-47ed-bd0b-34fc193eb3f1",
    "address": "169.254.238.114",
    "port": 8788,
    "sslPort": null,
    "payload": {
        "@class": "org.springframework.cloud.zookeeper.discovery.ZookeeperInstance",
        "id": "application-1",
        "name": "dubbo-consumer",
        "metadata": {
            "instance_status": "UP"
        }
    },
    "registrationTimeUTC": 1620123669588,
    "serviceType": "DYNAMIC",
    "uriSpec": {
        "parts": [
            {
                "value": "scheme",
                "variable": true
            },
            {
                "value": "://",
                "variable": false
            },
            {
                "value": "address",
                "variable": true
            },
            {
                "value": ":",
                "variable": false
            },
            {
                "value": "port",
                "variable": true
            }
        ]
    }
}
```

## ğŸ°ç½‘å…³è°ƒç”¨

æœåŠ¡æ³¨å†Œä¸Šå»åï¼Œæˆ‘ä»¬å°±å¯ä»¥ä¿®æ”¹ä¸‹æˆ‘ä»¬ä¸ŠèŠ‚ç½‘å…³é¡¹ç›®åˆ°è·¯ç”±é…ç½®ï¼ŒæŠŠå®ƒæ”¹æˆç”¨æœåŠ¡åè°ƒç”¨ã€‚æˆ‘ä»¬å¯ä»¥ä¿®æ”¹ yml é…ç½®ï¼ŒæŠŠ `uri` æ”¹æˆæœåŠ¡è°ƒç”¨çš„æ ¼å¼

```yaml
spring:
  cloud:
    gateway:
      routes:
        - id: route-demo
          uri: lb://dubbo-consumer
          predicates:
            - Path=/**
```

æˆ–è€…å¦‚æœæˆ‘ä»¬æ˜¯ç”¨ Java ä»£ç æ–¹å¼é…ç½®çš„è·¯ç”±å¯ä»¥æ”¹æˆå¦‚ä¸‹ä»£ç ï¼š

```java
@Bean
public RouteLocator routesConfig(RouteLocatorBuilder builder){
	return builder.routes()
			.route("route-demo",r -> r.path("/**").uri("lb://dubbo-consumer"))
			.build();
}
```

ä¿®æ”¹å®Œæˆåï¼Œå¯åŠ¨ç½‘å…³ï¼Œç„¶åè®¿é—®ç½‘å…³åœ°å€ [`http://localhost:8080/consumer`](http://localhost:8080/consumer) å°±å¯ä»¥çœ‹åˆ°é¡µé¢æ˜¾ç¤º `hello! This is Dubbo's demo`
