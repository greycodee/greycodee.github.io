<!doctype html><html lang=en-us><head><link rel=preload href=/lib/font-awesome/webfonts/fa-brands-400.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/font-awesome/webfonts/fa-regular-400.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/font-awesome/webfonts/fa-solid-900.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/JetBrainsMono/web/woff2/JetBrainsMono-Regular.woff2 as=font type=font/woff2 crossorigin=anonymous><script type=text/javascript src=https://latest.cactus.chat/cactus.js></script>
<link rel=stylesheet href=https://latest.cactus.chat/style.css type=text/css><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>RocketMQ集群搭建 | Greycode's Blog</title><link rel=canonical href=https://greycode.top/posts/rocketmq-cluster-build/><meta name=description content="Hello,I‘m Greycode. Please use Chrome to browse this site for a better experience."><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="all,follow"><meta name=googlebot content="index,follow,snippet,archive"><meta property="og:title" content="RocketMQ集群搭建"><meta property="og:description" content="本文只讲RocketMQ集群的搭建(异步复制)，具体理论知识后续会在写新文章详细介绍;
环境 JDK1.8 Centos7 主机-两台 centos7_1 :172.16.54.130 centos7_2 :172.16.54.128 软件资源 JDK1.8 :https://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html RocketMQ4.5.2 :http://mirrors.tuna.tsinghua.edu.cn/apache/rocketmq/4.5.2/rocketmq-all-4.5.2-bin-release.zip 安装JDK 首先分别在两台主机上安装JDK1.8，具体安装方法这里就不说了，网上随便搜一搜都有；
配置RocketMQ 把下载的RocketMQ包分别上传到两台服务器上，然后用命令解压:
# unzip rocketmq-all-4.5.2-bin-release.zip 编写配置文件 这一步很重要，集群的搭建关键在于配置文件的编写，首先看看RocketMQ配置文件的解析:
#所属集群名字 brokerClusterName=rocketmq-cluster #broker名字，每队master和slave保持一致 brokerName=broker-a #0 表示 Master，>0 表示 Slave brokerId=0 #指定主机ip brokerIP1 = 主机IP #nameServer地址，分号分割 namesrvAddr=主机IP:9876;主机IP:9876 #在发送消息时，自动创建服务器不存在的topic，默认创建的队列数 defaultTopicQueueNums=4 #是否允许 Broker 自动创建Topic，建议线下开启，线上关闭 autoCreateTopicEnable=true #是否允许 Broker 自动创建订阅组，建议线下开启，线上关闭 autoCreateSubscriptionGroup=true #Broker 对外服务的监听端口 listenPort=10911 #删除文件时间点，默认凌晨 4点 deleteWhen=04 #文件保留时间，默认 48 小时 fileReservedTime=120 #commitLog每个文件的大小默认1G mapedFileSizeCommitLog=1073741824 #ConsumeQueue每个文件默认存30W条，根据业务情况调整 mapedFileSizeConsumeQueue=300000 #检测物理文件磁盘空间 diskMaxUsedSpaceRatio=88 #存储路径 storePathRootDir=/usr/local/rocketmq/store #commitLog 存储路径 storePathCommitLog=/usr/local/rocketmq/store/commitlog #消费队列存储路径存储路径 storePathConsumeQueue=/usr/local/rocketmq/store/consumequeue #消息索引存储路径 storePathIndex=/usr/local/rocketmq/store/index #checkpoint 文件存储路径 storeCheckpoint=/usr/local/rocketmq/store/checkpoint #Broker 的角色 #- ASYNC_MASTER 异步复制Master #- SYNC_MASTER 同步双写Master #- SLAVE brokerRole=ASYNC_MASTER #刷盘方式 #- ASYNC_FLUSH 异步刷盘 #- SYNC_FLUSH 同步刷盘 flushDiskType=ASYNC_FLUSH #checkTransactionMessageEnable=false #abort 文件存储路径 abortFile=/usr/javawork/apache-rocketmq/store/abort #限制的消息大小 maxMessageSize=65536 以上配置可根据个人需求加入到自己的配置文件中；RocketMQ官方已经为我们创建好了简单的集群配置文件，进去解压后的文件夹，在进入到conf文件夹，可以看到里面有三个文件夹："><meta property="og:type" content="article"><meta property="og:url" content="https://greycode.top/posts/rocketmq-cluster-build/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2019-10-09T20:55:36+00:00"><meta property="article:modified_time" content="2019-10-09T20:55:36+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="RocketMQ集群搭建"><meta name=twitter:description content="本文只讲RocketMQ集群的搭建(异步复制)，具体理论知识后续会在写新文章详细介绍;
环境 JDK1.8 Centos7 主机-两台 centos7_1 :172.16.54.130 centos7_2 :172.16.54.128 软件资源 JDK1.8 :https://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html RocketMQ4.5.2 :http://mirrors.tuna.tsinghua.edu.cn/apache/rocketmq/4.5.2/rocketmq-all-4.5.2-bin-release.zip 安装JDK 首先分别在两台主机上安装JDK1.8，具体安装方法这里就不说了，网上随便搜一搜都有；
配置RocketMQ 把下载的RocketMQ包分别上传到两台服务器上，然后用命令解压:
# unzip rocketmq-all-4.5.2-bin-release.zip 编写配置文件 这一步很重要，集群的搭建关键在于配置文件的编写，首先看看RocketMQ配置文件的解析:
#所属集群名字 brokerClusterName=rocketmq-cluster #broker名字，每队master和slave保持一致 brokerName=broker-a #0 表示 Master，>0 表示 Slave brokerId=0 #指定主机ip brokerIP1 = 主机IP #nameServer地址，分号分割 namesrvAddr=主机IP:9876;主机IP:9876 #在发送消息时，自动创建服务器不存在的topic，默认创建的队列数 defaultTopicQueueNums=4 #是否允许 Broker 自动创建Topic，建议线下开启，线上关闭 autoCreateTopicEnable=true #是否允许 Broker 自动创建订阅组，建议线下开启，线上关闭 autoCreateSubscriptionGroup=true #Broker 对外服务的监听端口 listenPort=10911 #删除文件时间点，默认凌晨 4点 deleteWhen=04 #文件保留时间，默认 48 小时 fileReservedTime=120 #commitLog每个文件的大小默认1G mapedFileSizeCommitLog=1073741824 #ConsumeQueue每个文件默认存30W条，根据业务情况调整 mapedFileSizeConsumeQueue=300000 #检测物理文件磁盘空间 diskMaxUsedSpaceRatio=88 #存储路径 storePathRootDir=/usr/local/rocketmq/store #commitLog 存储路径 storePathCommitLog=/usr/local/rocketmq/store/commitlog #消费队列存储路径存储路径 storePathConsumeQueue=/usr/local/rocketmq/store/consumequeue #消息索引存储路径 storePathIndex=/usr/local/rocketmq/store/index #checkpoint 文件存储路径 storeCheckpoint=/usr/local/rocketmq/store/checkpoint #Broker 的角色 #- ASYNC_MASTER 异步复制Master #- SYNC_MASTER 同步双写Master #- SLAVE brokerRole=ASYNC_MASTER #刷盘方式 #- ASYNC_FLUSH 异步刷盘 #- SYNC_FLUSH 同步刷盘 flushDiskType=ASYNC_FLUSH #checkTransactionMessageEnable=false #abort 文件存储路径 abortFile=/usr/javawork/apache-rocketmq/store/abort #限制的消息大小 maxMessageSize=65536 以上配置可根据个人需求加入到自己的配置文件中；RocketMQ官方已经为我们创建好了简单的集群配置文件，进去解压后的文件夹，在进入到conf文件夹，可以看到里面有三个文件夹："><link rel=stylesheet href=https://greycode.top/css/styles.94f653e9e151e28067a7c5dbbc4600cbd5a3c721e79faaf971e523c40f3b249b8e4f20bb57810dfffa8d559ca5c140fd56eb4cd9c0853113ad08e66afdb08bdd.css integrity="sha512-lPZT6eFR4oBnp8XbvEYAy9WjxyHnn6r5ceUjxA87JJuOTyC7V4EN//qNVZylwUD9VutM2cCFMROtCOZq/bCL3Q=="><!--[if lt IE 9]><script src=https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js></script>
<script src=https://oss.maxcdn.com/respond/1.4.2/respond.min.js></script><![endif]--><link rel=icon type=image/png href=https://greycode.top/images/favicon.ico><script async src="https://www.googletagmanager.com/gtag/js?id=G-JVLPYZM5G1"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-JVLPYZM5G1",{anonymize_ip:!1})}</script></head><body class="max-width mx-auto px3 ltr"><div class="content index py4"><div id=header-post><a id=menu-icon href=#><i class="fas fa-bars fa-lg"></i></a>
<a id=menu-icon-tablet href=#><i class="fas fa-bars fa-lg"></i></a>
<a id=top-icon-tablet href=# onclick='$("html, body").animate({scrollTop:0},"fast")' style=display:none aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg"></i></a>
<span id=menu><span id=nav><ul><li><a href=/>Home</a></li><li><a href=/posts>All posts</a></li><li><a href=/categories>Categories</a></li><li><a href=/tags>Tags</a></li></ul></span><br><span id=actions><ul><li><a class=icon href=https://greycode.top/posts/vue-cli3-11-problem/ aria-label=Previous><i class="fas fa-chevron-left" aria-hidden=true onmouseover='$("#i-prev").toggle()' onmouseout='$("#i-prev").toggle()'></i></a></li><li><a class=icon href=https://greycode.top/posts/gof-singleton/ aria-label=Next><i class="fas fa-chevron-right" aria-hidden=true onmouseover='$("#i-next").toggle()' onmouseout='$("#i-next").toggle()'></i></a></li><li><a class=icon href=# onclick='$("html, body").animate({scrollTop:0},"fast")' aria-label="Top of Page"><i class="fas fa-chevron-up" aria-hidden=true onmouseover='$("#i-top").toggle()' onmouseout='$("#i-top").toggle()'></i></a></li><li><a class=icon href=# aria-label=Share><i class="fas fa-share-alt" aria-hidden=true onmouseover='$("#i-share").toggle()' onmouseout='$("#i-share").toggle()' onclick='return $("#share").toggle(),!1'></i></a></li></ul><span id=i-prev class=info style=display:none>Previous post</span>
<span id=i-next class=info style=display:none>Next post</span>
<span id=i-top class=info style=display:none>Back to top</span>
<span id=i-share class=info style=display:none>Share post</span></span><br><div id=share style=display:none><ul><li><a class=icon href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fgreycode.top%2fposts%2frocketmq-cluster-build%2f" aria-label=Facebook><i class="fab fa-facebook" aria-hidden=true></i></a></li><li><a class=icon href="https://twitter.com/share?url=https%3a%2f%2fgreycode.top%2fposts%2frocketmq-cluster-build%2f&text=RocketMQ%e9%9b%86%e7%be%a4%e6%90%ad%e5%bb%ba" aria-label=Twitter><i class="fab fa-twitter" aria-hidden=true></i></a></li><li><a class=icon href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fgreycode.top%2fposts%2frocketmq-cluster-build%2f&title=RocketMQ%e9%9b%86%e7%be%a4%e6%90%ad%e5%bb%ba" aria-label=Linkedin><i class="fab fa-linkedin" aria-hidden=true></i></a></li><li><a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fgreycode.top%2fposts%2frocketmq-cluster-build%2f&is_video=false&description=RocketMQ%e9%9b%86%e7%be%a4%e6%90%ad%e5%bb%ba" aria-label=Pinterest><i class="fab fa-pinterest" aria-hidden=true></i></a></li><li><a class=icon href="mailto:?subject=RocketMQ%e9%9b%86%e7%be%a4%e6%90%ad%e5%bb%ba&body=Check out this article: https%3a%2f%2fgreycode.top%2fposts%2frocketmq-cluster-build%2f" aria-label=Email><i class="fas fa-envelope" aria-hidden=true></i></a></li><li><a class=icon href="https://getpocket.com/save?url=https%3a%2f%2fgreycode.top%2fposts%2frocketmq-cluster-build%2f&title=RocketMQ%e9%9b%86%e7%be%a4%e6%90%ad%e5%bb%ba" aria-label=Pocket><i class="fab fa-get-pocket" aria-hidden=true></i></a></li><li><a class=icon href="http://reddit.com/submit?url=https%3a%2f%2fgreycode.top%2fposts%2frocketmq-cluster-build%2f&title=RocketMQ%e9%9b%86%e7%be%a4%e6%90%ad%e5%bb%ba" aria-label=reddit><i class="fab fa-reddit" aria-hidden=true></i></a></li><li><a class=icon href="http://www.tumblr.com/share/link?url=https%3a%2f%2fgreycode.top%2fposts%2frocketmq-cluster-build%2f&name=RocketMQ%e9%9b%86%e7%be%a4%e6%90%ad%e5%bb%ba&description=%e6%9c%ac%e6%96%87%e5%8f%aa%e8%ae%b2RocketMQ%e9%9b%86%e7%be%a4%e7%9a%84%e6%90%ad%e5%bb%ba%28%e5%bc%82%e6%ad%a5%e5%a4%8d%e5%88%b6%29%ef%bc%8c%e5%85%b7%e4%bd%93%e7%90%86%e8%ae%ba%e7%9f%a5%e8%af%86%e5%90%8e%e7%bb%ad%e4%bc%9a%e5%9c%a8%e5%86%99%e6%96%b0%e6%96%87%e7%ab%a0%e8%af%a6%e7%bb%86%e4%bb%8b%e7%bb%8d%3b%0a%e7%8e%af%e5%a2%83%20JDK1.8%20Centos7%20%e4%b8%bb%e6%9c%ba-%e4%b8%a4%e5%8f%b0%20centos7_1%20%3a172.16.54.130%20centos7_2%20%3a172.16.54.128%20%e8%bd%af%e4%bb%b6%e8%b5%84%e6%ba%90%20JDK1.8%20%3ahttps%3a%2f%2fwww.oracle.com%2ftechnetwork%2fjava%2fjavase%2fdownloads%2fjdk8-downloads-2133151.html%20RocketMQ4.5.2%20%3ahttp%3a%2f%2fmirrors.tuna.tsinghua.edu.cn%2fapache%2frocketmq%2f4.5.2%2frocketmq-all-4.5.2-bin-release.zip%20%e5%ae%89%e8%a3%85JDK%20%e9%a6%96%e5%85%88%e5%88%86%e5%88%ab%e5%9c%a8%e4%b8%a4%e5%8f%b0%e4%b8%bb%e6%9c%ba%e4%b8%8a%e5%ae%89%e8%a3%85JDK1.8%ef%bc%8c%e5%85%b7%e4%bd%93%e5%ae%89%e8%a3%85%e6%96%b9%e6%b3%95%e8%bf%99%e9%87%8c%e5%b0%b1%e4%b8%8d%e8%af%b4%e4%ba%86%ef%bc%8c%e7%bd%91%e4%b8%8a%e9%9a%8f%e4%be%bf%e6%90%9c%e4%b8%80%e6%90%9c%e9%83%bd%e6%9c%89%ef%bc%9b%0a%e9%85%8d%e7%bd%aeRocketMQ%20%e6%8a%8a%e4%b8%8b%e8%bd%bd%e7%9a%84RocketMQ%e5%8c%85%e5%88%86%e5%88%ab%e4%b8%8a%e4%bc%a0%e5%88%b0%e4%b8%a4%e5%8f%b0%e6%9c%8d%e5%8a%a1%e5%99%a8%e4%b8%8a%ef%bc%8c%e7%84%b6%e5%90%8e%e7%94%a8%e5%91%bd%e4%bb%a4%e8%a7%a3%e5%8e%8b%3a%0a%23%20unzip%20rocketmq-all-4.5.2-bin-release.zip%20%e7%bc%96%e5%86%99%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6%20%e8%bf%99%e4%b8%80%e6%ad%a5%e5%be%88%e9%87%8d%e8%a6%81%ef%bc%8c%e9%9b%86%e7%be%a4%e7%9a%84%e6%90%ad%e5%bb%ba%e5%85%b3%e9%94%ae%e5%9c%a8%e4%ba%8e%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6%e7%9a%84%e7%bc%96%e5%86%99%ef%bc%8c%e9%a6%96%e5%85%88%e7%9c%8b%e7%9c%8bRocketMQ%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6%e7%9a%84%e8%a7%a3%e6%9e%90%3a%0a%23%e6%89%80%e5%b1%9e%e9%9b%86%e7%be%a4%e5%90%8d%e5%ad%97%20brokerClusterName%3drocketmq-cluster%20%23broker%e5%90%8d%e5%ad%97%ef%bc%8c%e6%af%8f%e9%98%9fmaster%e5%92%8cslave%e4%bf%9d%e6%8c%81%e4%b8%80%e8%87%b4%20brokerName%3dbroker-a%20%230%20%e8%a1%a8%e7%a4%ba%20Master%ef%bc%8c%26gt%3b0%20%e8%a1%a8%e7%a4%ba%20Slave%20brokerId%3d0%20%23%e6%8c%87%e5%ae%9a%e4%b8%bb%e6%9c%baip%20brokerIP1%20%3d%20%e4%b8%bb%e6%9c%baIP%20%23nameServer%e5%9c%b0%e5%9d%80%ef%bc%8c%e5%88%86%e5%8f%b7%e5%88%86%e5%89%b2%20namesrvAddr%3d%e4%b8%bb%e6%9c%baIP%3a9876%3b%e4%b8%bb%e6%9c%baIP%3a9876%20%23%e5%9c%a8%e5%8f%91%e9%80%81%e6%b6%88%e6%81%af%e6%97%b6%ef%bc%8c%e8%87%aa%e5%8a%a8%e5%88%9b%e5%bb%ba%e6%9c%8d%e5%8a%a1%e5%99%a8%e4%b8%8d%e5%ad%98%e5%9c%a8%e7%9a%84topic%ef%bc%8c%e9%bb%98%e8%ae%a4%e5%88%9b%e5%bb%ba%e7%9a%84%e9%98%9f%e5%88%97%e6%95%b0%20defaultTopicQueueNums%3d4%20%23%e6%98%af%e5%90%a6%e5%85%81%e8%ae%b8%20Broker%20%e8%87%aa%e5%8a%a8%e5%88%9b%e5%bb%baTopic%ef%bc%8c%e5%bb%ba%e8%ae%ae%e7%ba%bf%e4%b8%8b%e5%bc%80%e5%90%af%ef%bc%8c%e7%ba%bf%e4%b8%8a%e5%85%b3%e9%97%ad%20autoCreateTopicEnable%3dtrue%20%23%e6%98%af%e5%90%a6%e5%85%81%e8%ae%b8%20Broker%20%e8%87%aa%e5%8a%a8%e5%88%9b%e5%bb%ba%e8%ae%a2%e9%98%85%e7%bb%84%ef%bc%8c%e5%bb%ba%e8%ae%ae%e7%ba%bf%e4%b8%8b%e5%bc%80%e5%90%af%ef%bc%8c%e7%ba%bf%e4%b8%8a%e5%85%b3%e9%97%ad%20autoCreateSubscriptionGroup%3dtrue%20%23Broker%20%e5%af%b9%e5%a4%96%e6%9c%8d%e5%8a%a1%e7%9a%84%e7%9b%91%e5%90%ac%e7%ab%af%e5%8f%a3%20listenPort%3d10911%20%23%e5%88%a0%e9%99%a4%e6%96%87%e4%bb%b6%e6%97%b6%e9%97%b4%e7%82%b9%ef%bc%8c%e9%bb%98%e8%ae%a4%e5%87%8c%e6%99%a8%204%e7%82%b9%20deleteWhen%3d04%20%23%e6%96%87%e4%bb%b6%e4%bf%9d%e7%95%99%e6%97%b6%e9%97%b4%ef%bc%8c%e9%bb%98%e8%ae%a4%2048%20%e5%b0%8f%e6%97%b6%20fileReservedTime%3d120%20%23commitLog%e6%af%8f%e4%b8%aa%e6%96%87%e4%bb%b6%e7%9a%84%e5%a4%a7%e5%b0%8f%e9%bb%98%e8%ae%a41G%20mapedFileSizeCommitLog%3d1073741824%20%23ConsumeQueue%e6%af%8f%e4%b8%aa%e6%96%87%e4%bb%b6%e9%bb%98%e8%ae%a4%e5%ad%9830W%e6%9d%a1%ef%bc%8c%e6%a0%b9%e6%8d%ae%e4%b8%9a%e5%8a%a1%e6%83%85%e5%86%b5%e8%b0%83%e6%95%b4%20mapedFileSizeConsumeQueue%3d300000%20%23%e6%a3%80%e6%b5%8b%e7%89%a9%e7%90%86%e6%96%87%e4%bb%b6%e7%a3%81%e7%9b%98%e7%a9%ba%e9%97%b4%20diskMaxUsedSpaceRatio%3d88%20%23%e5%ad%98%e5%82%a8%e8%b7%af%e5%be%84%20storePathRootDir%3d%2fusr%2flocal%2frocketmq%2fstore%20%23commitLog%20%e5%ad%98%e5%82%a8%e8%b7%af%e5%be%84%20storePathCommitLog%3d%2fusr%2flocal%2frocketmq%2fstore%2fcommitlog%20%23%e6%b6%88%e8%b4%b9%e9%98%9f%e5%88%97%e5%ad%98%e5%82%a8%e8%b7%af%e5%be%84%e5%ad%98%e5%82%a8%e8%b7%af%e5%be%84%20storePathConsumeQueue%3d%2fusr%2flocal%2frocketmq%2fstore%2fconsumequeue%20%23%e6%b6%88%e6%81%af%e7%b4%a2%e5%bc%95%e5%ad%98%e5%82%a8%e8%b7%af%e5%be%84%20storePathIndex%3d%2fusr%2flocal%2frocketmq%2fstore%2findex%20%23checkpoint%20%e6%96%87%e4%bb%b6%e5%ad%98%e5%82%a8%e8%b7%af%e5%be%84%20storeCheckpoint%3d%2fusr%2flocal%2frocketmq%2fstore%2fcheckpoint%20%23Broker%20%e7%9a%84%e8%a7%92%e8%89%b2%20%23-%20ASYNC_MASTER%20%e5%bc%82%e6%ad%a5%e5%a4%8d%e5%88%b6Master%20%23-%20SYNC_MASTER%20%e5%90%8c%e6%ad%a5%e5%8f%8c%e5%86%99Master%20%23-%20SLAVE%20brokerRole%3dASYNC_MASTER%20%23%e5%88%b7%e7%9b%98%e6%96%b9%e5%bc%8f%20%23-%20ASYNC_FLUSH%20%e5%bc%82%e6%ad%a5%e5%88%b7%e7%9b%98%20%23-%20SYNC_FLUSH%20%e5%90%8c%e6%ad%a5%e5%88%b7%e7%9b%98%20flushDiskType%3dASYNC_FLUSH%20%23checkTransactionMessageEnable%3dfalse%20%23abort%20%e6%96%87%e4%bb%b6%e5%ad%98%e5%82%a8%e8%b7%af%e5%be%84%20abortFile%3d%2fusr%2fjavawork%2fapache-rocketmq%2fstore%2fabort%20%23%e9%99%90%e5%88%b6%e7%9a%84%e6%b6%88%e6%81%af%e5%a4%a7%e5%b0%8f%20maxMessageSize%3d65536%20%e4%bb%a5%e4%b8%8a%e9%85%8d%e7%bd%ae%e5%8f%af%e6%a0%b9%e6%8d%ae%e4%b8%aa%e4%ba%ba%e9%9c%80%e6%b1%82%e5%8a%a0%e5%85%a5%e5%88%b0%e8%87%aa%e5%b7%b1%e7%9a%84%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6%e4%b8%ad%ef%bc%9bRocketMQ%e5%ae%98%e6%96%b9%e5%b7%b2%e7%bb%8f%e4%b8%ba%e6%88%91%e4%bb%ac%e5%88%9b%e5%bb%ba%e5%a5%bd%e4%ba%86%e7%ae%80%e5%8d%95%e7%9a%84%e9%9b%86%e7%be%a4%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6%ef%bc%8c%e8%bf%9b%e5%8e%bb%e8%a7%a3%e5%8e%8b%e5%90%8e%e7%9a%84%e6%96%87%e4%bb%b6%e5%a4%b9%ef%bc%8c%e5%9c%a8%e8%bf%9b%e5%85%a5%e5%88%b0conf%e6%96%87%e4%bb%b6%e5%a4%b9%ef%bc%8c%e5%8f%af%e4%bb%a5%e7%9c%8b%e5%88%b0%e9%87%8c%e9%9d%a2%e6%9c%89%e4%b8%89%e4%b8%aa%e6%96%87%e4%bb%b6%e5%a4%b9%ef%bc%9a" aria-label=Tumblr><i class="fab fa-tumblr" aria-hidden=true></i></a></li><li><a class=icon href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fgreycode.top%2fposts%2frocketmq-cluster-build%2f&t=RocketMQ%e9%9b%86%e7%be%a4%e6%90%ad%e5%bb%ba" aria-label="Hacker News"><i class="fab fa-hacker-news" aria-hidden=true></i></a></li></ul></div><div id=toc><nav id=TableOfContents><ul><li><a href=#环境>环境</a></li><li><a href=#主机-两台>主机-两台</a></li><li><a href=#软件资源>软件资源</a></li><li><a href=#安装jdk>安装JDK</a></li><li><a href=#配置rocketmq>配置RocketMQ</a><ul><li><a href=#编写配置文件>编写配置文件</a></li></ul></li><li><a href=#设置rocketmq运行的jvm内存非必须>设置RocketMQ运行的JVM内存(非必须)</a></li><li><a href=#启动rocketmq>启动RocketMQ</a></li><li><a href=#搭建console可视化控制台>搭建Console可视化控制台</a></li></ul></nav></div></span></div><article class=post itemscope itemtype=http://schema.org/BlogPosting><header><h1 class=posttitle itemprop="name headline">RocketMQ集群搭建</h1><div class=meta><div class=postdate><time datetime="2019-10-09 20:55:36 +0000 UTC" itemprop=datePublished>2019-10-09</time></div><div class=article-category><i class="fas fa-archive"></i>
<a class=category-link href=/categories/rocketmq>RocketMQ</a></div><div class=article-tag><i class="fas fa-tag"></i>
<a class=tag-link href=/tags/rocketmq rel=tag>RocketMQ</a>
,
<a class=tag-link href=/tags/linux rel=tag>Linux</a></div></div></header><div class=content itemprop=articleBody><p>本文只讲RocketMQ集群的搭建(异步复制)，具体理论知识后续会在写新文章详细介绍;</p><h2 id=环境>环境</h2><ul><li>JDK1.8</li><li>Centos7</li></ul><h2 id=主机-两台>主机-两台</h2><ul><li>centos7_1 :172.16.54.130</li><li>centos7_2 :172.16.54.128</li></ul><h2 id=软件资源>软件资源</h2><ul><li>JDK1.8 :https://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html</li><li>RocketMQ4.5.2 :http://mirrors.tuna.tsinghua.edu.cn/apache/rocketmq/4.5.2/rocketmq-all-4.5.2-bin-release.zip</li></ul><h2 id=安装jdk>安装JDK</h2><p>首先分别在两台主机上安装JDK1.8，具体安装方法这里就不说了，网上随便搜一搜都有；</p><h2 id=配置rocketmq>配置RocketMQ</h2><p>把下载的RocketMQ包分别上传到两台服务器上，然后用命令解压:</p><div class=highlight><pre tabindex=0 style=color:#2f1e2e;background-color:#e7e9db;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#8d8687># unzip rocketmq-all-4.5.2-bin-release.zip</span>
</span></span></code></pre></div><h3 id=编写配置文件>编写配置文件</h3><p>这一步很重要，集群的搭建关键在于配置文件的编写，首先看看RocketMQ配置文件的解析:</p><pre tabindex=0><code class=language-properties data-lang=properties>#所属集群名字 
brokerClusterName=rocketmq-cluster

#broker名字，每队master和slave保持一致
brokerName=broker-a

#0 表示 Master，&gt;0 表示 Slave
brokerId=0 

#指定主机ip
brokerIP1 = 主机IP

#nameServer地址，分号分割
namesrvAddr=主机IP:9876;主机IP:9876

#在发送消息时，自动创建服务器不存在的topic，默认创建的队列数 
defaultTopicQueueNums=4

#是否允许 Broker 自动创建Topic，建议线下开启，线上关闭 
autoCreateTopicEnable=true

#是否允许 Broker 自动创建订阅组，建议线下开启，线上关闭 
autoCreateSubscriptionGroup=true

#Broker 对外服务的监听端口 
listenPort=10911

#删除文件时间点，默认凌晨 4点
 deleteWhen=04

#文件保留时间，默认 48 小时 
fileReservedTime=120

#commitLog每个文件的大小默认1G 
mapedFileSizeCommitLog=1073741824

#ConsumeQueue每个文件默认存30W条，根据业务情况调整
mapedFileSizeConsumeQueue=300000

#检测物理文件磁盘空间
diskMaxUsedSpaceRatio=88

#存储路径
storePathRootDir=/usr/local/rocketmq/store
#commitLog 存储路径 
storePathCommitLog=/usr/local/rocketmq/store/commitlog
#消费队列存储路径存储路径
storePathConsumeQueue=/usr/local/rocketmq/store/consumequeue
#消息索引存储路径
storePathIndex=/usr/local/rocketmq/store/index
#checkpoint 文件存储路径
storeCheckpoint=/usr/local/rocketmq/store/checkpoint

#Broker 的角色
#- ASYNC_MASTER 异步复制Master
#- SYNC_MASTER 同步双写Master
#- SLAVE 
brokerRole=ASYNC_MASTER

#刷盘方式
#- ASYNC_FLUSH 异步刷盘
#- SYNC_FLUSH 同步刷盘 flushDiskType=ASYNC_FLUSH
#checkTransactionMessageEnable=false

#abort 文件存储路径
abortFile=/usr/javawork/apache-rocketmq/store/abort

#限制的消息大小 maxMessageSize=65536
</code></pre><p>以上配置可根据个人需求加入到自己的配置文件中；RocketMQ官方已经为我们创建好了简单的集群配置文件，进去解压后的文件夹，在进入到conf文件夹，可以看到里面有三个文件夹：</p><ul><li>2m-2s-async :2个master，2个slave，async异步复制</li><li>2m-2s-sync :2个master，2个slave，sync同步双写</li><li>2m-noslave :2个master,没有slave</li></ul><p>这里我们用async异步复制模式，进入文件夹，分别编辑：</p><h4 id=centos7_1主机编辑如下两个配置文件>centos7_1主机编辑如下两个配置文件</h4><blockquote><p>注意，master和slave的文件存储路径不能用同一个路径，所以必须要区分开。</p></blockquote><h5 id=broker-aproperties>broker-a.properties</h5><pre tabindex=0><code class=language-properties data-lang=properties>brokerClusterName=DefaultCluster
brokerName=broker-a
brokerId=0
deleteWhen=04
fileReservedTime=48
brokerRole=ASYNC_MASTER
flushDiskType=ASYNC_FLUSH
namesrvAddr=172.16.54.128:9876;172.16.54.130:9876
listenPort=10911
#存储路径
storePathRootDir=/usr/local/rocketmq/master/store
#commitLog 存储路径 
storePathCommitLog=/usr/local/rocketmq/master/store/commitlog
#消费队列存储路径存储路径
storePathConsumeQueue=/usr/local/rocketmq/master/store/consumequeue
#消息索引存储路径
storePathIndex=/usr/local/rocketmq/master/store/index
#checkpoint 文件存储路径
storeCheckpoint=/usr/local/rocketmq/master/store/checkpoint
</code></pre><p><em>这个监听端口设置设置成10911后还会自动监听10909,10912这两个端口，所以要配置文件要避免设置到相应的端口。</em></p><h5 id=broker-a-sproperties>broker-a-s.properties</h5><pre tabindex=0><code class=language-properties data-lang=properties>brokerClusterName=DefaultCluster
brokerName=broker-a
brokerId=1
deleteWhen=04
fileReservedTime=48
brokerRole=SLAVE
flushDiskType=ASYNC_FLUSH
namesrvAddr=172.16.54.128:9876;172.16.54.130:9876
listenPort=20911
#存储路径
storePathRootDir=/usr/local/rocketmq/slave/store
#commitLog 存储路径 
storePathCommitLog=/usr/local/rocketmq/slave/store/commitlog
#消费队列存储路径存储路径
storePathConsumeQueue=/usr/local/rocketmq/slave/store/consumequeue
#消息索引存储路径
storePathIndex=/usr/local/rocketmq/slave/store/index
#checkpoint 文件存储路径
storeCheckpoint=/usr/local/rocketmq/slave/store/checkpoint
</code></pre><p><em>这个监听端口设置设置成20911后还会自动监听20909,20912这两个端口，所以要配置文件要避免设置到相应的端口。</em></p><h4 id=centos7_2主机编辑如下两个配置文件>centos7_2主机编辑如下两个配置文件</h4><h5 id=和centos7_1主机配置一样这边就不写了不过brokername要设置成不同的我这边设置成broker-b>和centos7_1主机配置一样，这边就不写了，不过brokerName要设置成不同的，我这边设置成broker-b。</h5><h2 id=设置rocketmq运行的jvm内存非必须>设置RocketMQ运行的JVM内存(非必须)</h2><blockquote><p>此项设置非必须，如果你主机内存很大的话可以不设置，RocketMQ默认要8G。</p></blockquote><p>进入rocketmq-all-4.5.2-bin-release/bin目录，两台主机分别设置runbroker.sh和runserver.sh这两个文件。</p><ul><li>runbroker.sh：找到如下一行配置</li></ul><pre tabindex=0><code class=language-properties data-lang=properties>JAVA_OPT=&#34;${JAVA_OPT} -server -Xms8g -Xmx8g -Xmn4g&#34;

改成：
JAVA_OPT=&#34;${JAVA_OPT} -server -Xms512m -Xmx512m -Xmn256m&#34;
</code></pre><ul><li>runserver.sh: 找到如下一行配置</li></ul><pre tabindex=0><code class=language-properties data-lang=properties>JAVA_OPT=&#34;${JAVA_OPT} -server -Xms4g -Xmx4g -Xmn2g -XX:MetaspaceSize=128m -XX:MaxMetaspaceSize=320m&#34;

改成：
JAVA_OPT=&#34;${JAVA_OPT} -server -Xms512m -Xmx512m -Xmn256m -XX:MetaspaceSize=128m -XX:MaxMetaspaceSize=320m&#34;
</code></pre><h2 id=启动rocketmq>启动RocketMQ</h2><blockquote><p>启动RocketMQ前为了方便访问，先关闭两台主机的防火墙。执行如下命令：</p><div class=highlight><pre tabindex=0 style=color:#2f1e2e;background-color:#e7e9db;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#8d8687># service firewalld stop</span>
</span></span></code></pre></div></blockquote><p>进入rocketmq-all-4.5.2-bin-release/bin这个目录，两台主机分别执行以下命令：</p><ul><li>启动namesrv</li></ul><div class=highlight><pre tabindex=0 style=color:#2f1e2e;background-color:#e7e9db;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#8d8687># nohup sh mqnamesrv &amp;</span>
</span></span></code></pre></div><ul><li>启动broker-master</li></ul><div class=highlight><pre tabindex=0 style=color:#2f1e2e;background-color:#e7e9db;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#8d8687># nohup sh mqbroker -c ../conf/2m-2s-async/broker-a.properties &amp;</span>
</span></span></code></pre></div><ul><li>启动broker-slave</li></ul><div class=highlight><pre tabindex=0 style=color:#2f1e2e;background-color:#e7e9db;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#8d8687># nohup sh mqbroker -c ../conf/2m-2s-async/broker-a-s.properties &amp;</span>
</span></span></code></pre></div><p><em>注意两台主机启动broker时后面的-c记得加载你配置好的配置文件路径，别加载错了</em></p><h2 id=搭建console可视化控制台>搭建Console可视化控制台</h2><p>任意一台机器或者本地下载Console源码，地址：https://github.com/apache/rocketmq-externals，或者有git的话直接用命令拉取：</p><div class=highlight><pre tabindex=0 style=color:#2f1e2e;background-color:#e7e9db;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#8d8687># git clone https://github.com/apache/rocketmq-externals.git</span>
</span></span></code></pre></div><p>进去目录：</p><div class=highlight><pre tabindex=0 style=color:#2f1e2e;background-color:#e7e9db;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#8d8687># cd rocketmq-externals-master/rocketmq-console</span>
</span></span></code></pre></div><p>修改配置文件：</p><div class=highlight><pre tabindex=0 style=color:#2f1e2e;background-color:#e7e9db;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#8d8687># vim src/main/resources/application.properties</span>
</span></span></code></pre></div><p>添加两个namesvr的主机ip</p><pre tabindex=0><code class=language-properties data-lang=properties>rocketmq.config.namesrvAddr=172.16.54.128:9876;172.16.54.130:9876
</code></pre><p>然后进项目跟目录，运行项目</p><div class=highlight><pre tabindex=0 style=color:#2f1e2e;background-color:#e7e9db;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#8d8687># mvn sprint-boot:run</span>
</span></span></code></pre></div><p>浏览器访问：</p><p><img src=https://cdn.jsdelivr.net/gh/greycodee/images@main/images/2021/10/08/rocketmq_console.png alt=可视化Console界面></p></div></article><div id=footer-post-container><div id=footer-post><div id=nav-footer style=display:none><ul><li><a href=/>Home</a></li><li><a href=/posts>All posts</a></li><li><a href=/categories>Categories</a></li><li><a href=/tags>Tags</a></li></ul></div><div id=toc-footer style=display:none><nav id=TableOfContents><ul><li><a href=#环境>环境</a></li><li><a href=#主机-两台>主机-两台</a></li><li><a href=#软件资源>软件资源</a></li><li><a href=#安装jdk>安装JDK</a></li><li><a href=#配置rocketmq>配置RocketMQ</a><ul><li><a href=#编写配置文件>编写配置文件</a></li></ul></li><li><a href=#设置rocketmq运行的jvm内存非必须>设置RocketMQ运行的JVM内存(非必须)</a></li><li><a href=#启动rocketmq>启动RocketMQ</a></li><li><a href=#搭建console可视化控制台>搭建Console可视化控制台</a></li></ul></nav></div><div id=share-footer style=display:none><ul><li><a class=icon href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fgreycode.top%2fposts%2frocketmq-cluster-build%2f" aria-label=Facebook><i class="fab fa-facebook fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://twitter.com/share?url=https%3a%2f%2fgreycode.top%2fposts%2frocketmq-cluster-build%2f&text=RocketMQ%e9%9b%86%e7%be%a4%e6%90%ad%e5%bb%ba" aria-label=Twitter><i class="fab fa-twitter fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fgreycode.top%2fposts%2frocketmq-cluster-build%2f&title=RocketMQ%e9%9b%86%e7%be%a4%e6%90%ad%e5%bb%ba" aria-label=Linkedin><i class="fab fa-linkedin fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fgreycode.top%2fposts%2frocketmq-cluster-build%2f&is_video=false&description=RocketMQ%e9%9b%86%e7%be%a4%e6%90%ad%e5%bb%ba" aria-label=Pinterest><i class="fab fa-pinterest fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="mailto:?subject=RocketMQ%e9%9b%86%e7%be%a4%e6%90%ad%e5%bb%ba&body=Check out this article: https%3a%2f%2fgreycode.top%2fposts%2frocketmq-cluster-build%2f" aria-label=Email><i class="fas fa-envelope fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://getpocket.com/save?url=https%3a%2f%2fgreycode.top%2fposts%2frocketmq-cluster-build%2f&title=RocketMQ%e9%9b%86%e7%be%a4%e6%90%ad%e5%bb%ba" aria-label=Pocket><i class="fab fa-get-pocket fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://reddit.com/submit?url=https%3a%2f%2fgreycode.top%2fposts%2frocketmq-cluster-build%2f&title=RocketMQ%e9%9b%86%e7%be%a4%e6%90%ad%e5%bb%ba" aria-label=reddit><i class="fab fa-reddit fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://www.tumblr.com/share/link?url=https%3a%2f%2fgreycode.top%2fposts%2frocketmq-cluster-build%2f&name=RocketMQ%e9%9b%86%e7%be%a4%e6%90%ad%e5%bb%ba&description=%e6%9c%ac%e6%96%87%e5%8f%aa%e8%ae%b2RocketMQ%e9%9b%86%e7%be%a4%e7%9a%84%e6%90%ad%e5%bb%ba%28%e5%bc%82%e6%ad%a5%e5%a4%8d%e5%88%b6%29%ef%bc%8c%e5%85%b7%e4%bd%93%e7%90%86%e8%ae%ba%e7%9f%a5%e8%af%86%e5%90%8e%e7%bb%ad%e4%bc%9a%e5%9c%a8%e5%86%99%e6%96%b0%e6%96%87%e7%ab%a0%e8%af%a6%e7%bb%86%e4%bb%8b%e7%bb%8d%3b%0a%e7%8e%af%e5%a2%83%20JDK1.8%20Centos7%20%e4%b8%bb%e6%9c%ba-%e4%b8%a4%e5%8f%b0%20centos7_1%20%3a172.16.54.130%20centos7_2%20%3a172.16.54.128%20%e8%bd%af%e4%bb%b6%e8%b5%84%e6%ba%90%20JDK1.8%20%3ahttps%3a%2f%2fwww.oracle.com%2ftechnetwork%2fjava%2fjavase%2fdownloads%2fjdk8-downloads-2133151.html%20RocketMQ4.5.2%20%3ahttp%3a%2f%2fmirrors.tuna.tsinghua.edu.cn%2fapache%2frocketmq%2f4.5.2%2frocketmq-all-4.5.2-bin-release.zip%20%e5%ae%89%e8%a3%85JDK%20%e9%a6%96%e5%85%88%e5%88%86%e5%88%ab%e5%9c%a8%e4%b8%a4%e5%8f%b0%e4%b8%bb%e6%9c%ba%e4%b8%8a%e5%ae%89%e8%a3%85JDK1.8%ef%bc%8c%e5%85%b7%e4%bd%93%e5%ae%89%e8%a3%85%e6%96%b9%e6%b3%95%e8%bf%99%e9%87%8c%e5%b0%b1%e4%b8%8d%e8%af%b4%e4%ba%86%ef%bc%8c%e7%bd%91%e4%b8%8a%e9%9a%8f%e4%be%bf%e6%90%9c%e4%b8%80%e6%90%9c%e9%83%bd%e6%9c%89%ef%bc%9b%0a%e9%85%8d%e7%bd%aeRocketMQ%20%e6%8a%8a%e4%b8%8b%e8%bd%bd%e7%9a%84RocketMQ%e5%8c%85%e5%88%86%e5%88%ab%e4%b8%8a%e4%bc%a0%e5%88%b0%e4%b8%a4%e5%8f%b0%e6%9c%8d%e5%8a%a1%e5%99%a8%e4%b8%8a%ef%bc%8c%e7%84%b6%e5%90%8e%e7%94%a8%e5%91%bd%e4%bb%a4%e8%a7%a3%e5%8e%8b%3a%0a%23%20unzip%20rocketmq-all-4.5.2-bin-release.zip%20%e7%bc%96%e5%86%99%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6%20%e8%bf%99%e4%b8%80%e6%ad%a5%e5%be%88%e9%87%8d%e8%a6%81%ef%bc%8c%e9%9b%86%e7%be%a4%e7%9a%84%e6%90%ad%e5%bb%ba%e5%85%b3%e9%94%ae%e5%9c%a8%e4%ba%8e%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6%e7%9a%84%e7%bc%96%e5%86%99%ef%bc%8c%e9%a6%96%e5%85%88%e7%9c%8b%e7%9c%8bRocketMQ%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6%e7%9a%84%e8%a7%a3%e6%9e%90%3a%0a%23%e6%89%80%e5%b1%9e%e9%9b%86%e7%be%a4%e5%90%8d%e5%ad%97%20brokerClusterName%3drocketmq-cluster%20%23broker%e5%90%8d%e5%ad%97%ef%bc%8c%e6%af%8f%e9%98%9fmaster%e5%92%8cslave%e4%bf%9d%e6%8c%81%e4%b8%80%e8%87%b4%20brokerName%3dbroker-a%20%230%20%e8%a1%a8%e7%a4%ba%20Master%ef%bc%8c%26gt%3b0%20%e8%a1%a8%e7%a4%ba%20Slave%20brokerId%3d0%20%23%e6%8c%87%e5%ae%9a%e4%b8%bb%e6%9c%baip%20brokerIP1%20%3d%20%e4%b8%bb%e6%9c%baIP%20%23nameServer%e5%9c%b0%e5%9d%80%ef%bc%8c%e5%88%86%e5%8f%b7%e5%88%86%e5%89%b2%20namesrvAddr%3d%e4%b8%bb%e6%9c%baIP%3a9876%3b%e4%b8%bb%e6%9c%baIP%3a9876%20%23%e5%9c%a8%e5%8f%91%e9%80%81%e6%b6%88%e6%81%af%e6%97%b6%ef%bc%8c%e8%87%aa%e5%8a%a8%e5%88%9b%e5%bb%ba%e6%9c%8d%e5%8a%a1%e5%99%a8%e4%b8%8d%e5%ad%98%e5%9c%a8%e7%9a%84topic%ef%bc%8c%e9%bb%98%e8%ae%a4%e5%88%9b%e5%bb%ba%e7%9a%84%e9%98%9f%e5%88%97%e6%95%b0%20defaultTopicQueueNums%3d4%20%23%e6%98%af%e5%90%a6%e5%85%81%e8%ae%b8%20Broker%20%e8%87%aa%e5%8a%a8%e5%88%9b%e5%bb%baTopic%ef%bc%8c%e5%bb%ba%e8%ae%ae%e7%ba%bf%e4%b8%8b%e5%bc%80%e5%90%af%ef%bc%8c%e7%ba%bf%e4%b8%8a%e5%85%b3%e9%97%ad%20autoCreateTopicEnable%3dtrue%20%23%e6%98%af%e5%90%a6%e5%85%81%e8%ae%b8%20Broker%20%e8%87%aa%e5%8a%a8%e5%88%9b%e5%bb%ba%e8%ae%a2%e9%98%85%e7%bb%84%ef%bc%8c%e5%bb%ba%e8%ae%ae%e7%ba%bf%e4%b8%8b%e5%bc%80%e5%90%af%ef%bc%8c%e7%ba%bf%e4%b8%8a%e5%85%b3%e9%97%ad%20autoCreateSubscriptionGroup%3dtrue%20%23Broker%20%e5%af%b9%e5%a4%96%e6%9c%8d%e5%8a%a1%e7%9a%84%e7%9b%91%e5%90%ac%e7%ab%af%e5%8f%a3%20listenPort%3d10911%20%23%e5%88%a0%e9%99%a4%e6%96%87%e4%bb%b6%e6%97%b6%e9%97%b4%e7%82%b9%ef%bc%8c%e9%bb%98%e8%ae%a4%e5%87%8c%e6%99%a8%204%e7%82%b9%20deleteWhen%3d04%20%23%e6%96%87%e4%bb%b6%e4%bf%9d%e7%95%99%e6%97%b6%e9%97%b4%ef%bc%8c%e9%bb%98%e8%ae%a4%2048%20%e5%b0%8f%e6%97%b6%20fileReservedTime%3d120%20%23commitLog%e6%af%8f%e4%b8%aa%e6%96%87%e4%bb%b6%e7%9a%84%e5%a4%a7%e5%b0%8f%e9%bb%98%e8%ae%a41G%20mapedFileSizeCommitLog%3d1073741824%20%23ConsumeQueue%e6%af%8f%e4%b8%aa%e6%96%87%e4%bb%b6%e9%bb%98%e8%ae%a4%e5%ad%9830W%e6%9d%a1%ef%bc%8c%e6%a0%b9%e6%8d%ae%e4%b8%9a%e5%8a%a1%e6%83%85%e5%86%b5%e8%b0%83%e6%95%b4%20mapedFileSizeConsumeQueue%3d300000%20%23%e6%a3%80%e6%b5%8b%e7%89%a9%e7%90%86%e6%96%87%e4%bb%b6%e7%a3%81%e7%9b%98%e7%a9%ba%e9%97%b4%20diskMaxUsedSpaceRatio%3d88%20%23%e5%ad%98%e5%82%a8%e8%b7%af%e5%be%84%20storePathRootDir%3d%2fusr%2flocal%2frocketmq%2fstore%20%23commitLog%20%e5%ad%98%e5%82%a8%e8%b7%af%e5%be%84%20storePathCommitLog%3d%2fusr%2flocal%2frocketmq%2fstore%2fcommitlog%20%23%e6%b6%88%e8%b4%b9%e9%98%9f%e5%88%97%e5%ad%98%e5%82%a8%e8%b7%af%e5%be%84%e5%ad%98%e5%82%a8%e8%b7%af%e5%be%84%20storePathConsumeQueue%3d%2fusr%2flocal%2frocketmq%2fstore%2fconsumequeue%20%23%e6%b6%88%e6%81%af%e7%b4%a2%e5%bc%95%e5%ad%98%e5%82%a8%e8%b7%af%e5%be%84%20storePathIndex%3d%2fusr%2flocal%2frocketmq%2fstore%2findex%20%23checkpoint%20%e6%96%87%e4%bb%b6%e5%ad%98%e5%82%a8%e8%b7%af%e5%be%84%20storeCheckpoint%3d%2fusr%2flocal%2frocketmq%2fstore%2fcheckpoint%20%23Broker%20%e7%9a%84%e8%a7%92%e8%89%b2%20%23-%20ASYNC_MASTER%20%e5%bc%82%e6%ad%a5%e5%a4%8d%e5%88%b6Master%20%23-%20SYNC_MASTER%20%e5%90%8c%e6%ad%a5%e5%8f%8c%e5%86%99Master%20%23-%20SLAVE%20brokerRole%3dASYNC_MASTER%20%23%e5%88%b7%e7%9b%98%e6%96%b9%e5%bc%8f%20%23-%20ASYNC_FLUSH%20%e5%bc%82%e6%ad%a5%e5%88%b7%e7%9b%98%20%23-%20SYNC_FLUSH%20%e5%90%8c%e6%ad%a5%e5%88%b7%e7%9b%98%20flushDiskType%3dASYNC_FLUSH%20%23checkTransactionMessageEnable%3dfalse%20%23abort%20%e6%96%87%e4%bb%b6%e5%ad%98%e5%82%a8%e8%b7%af%e5%be%84%20abortFile%3d%2fusr%2fjavawork%2fapache-rocketmq%2fstore%2fabort%20%23%e9%99%90%e5%88%b6%e7%9a%84%e6%b6%88%e6%81%af%e5%a4%a7%e5%b0%8f%20maxMessageSize%3d65536%20%e4%bb%a5%e4%b8%8a%e9%85%8d%e7%bd%ae%e5%8f%af%e6%a0%b9%e6%8d%ae%e4%b8%aa%e4%ba%ba%e9%9c%80%e6%b1%82%e5%8a%a0%e5%85%a5%e5%88%b0%e8%87%aa%e5%b7%b1%e7%9a%84%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6%e4%b8%ad%ef%bc%9bRocketMQ%e5%ae%98%e6%96%b9%e5%b7%b2%e7%bb%8f%e4%b8%ba%e6%88%91%e4%bb%ac%e5%88%9b%e5%bb%ba%e5%a5%bd%e4%ba%86%e7%ae%80%e5%8d%95%e7%9a%84%e9%9b%86%e7%be%a4%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6%ef%bc%8c%e8%bf%9b%e5%8e%bb%e8%a7%a3%e5%8e%8b%e5%90%8e%e7%9a%84%e6%96%87%e4%bb%b6%e5%a4%b9%ef%bc%8c%e5%9c%a8%e8%bf%9b%e5%85%a5%e5%88%b0conf%e6%96%87%e4%bb%b6%e5%a4%b9%ef%bc%8c%e5%8f%af%e4%bb%a5%e7%9c%8b%e5%88%b0%e9%87%8c%e9%9d%a2%e6%9c%89%e4%b8%89%e4%b8%aa%e6%96%87%e4%bb%b6%e5%a4%b9%ef%bc%9a" aria-label=Tumblr><i class="fab fa-tumblr fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fgreycode.top%2fposts%2frocketmq-cluster-build%2f&t=RocketMQ%e9%9b%86%e7%be%a4%e6%90%ad%e5%bb%ba" aria-label="Hacker News"><i class="fab fa-hacker-news fa-lg" aria-hidden=true></i></a></li></ul></div><div id=actions-footer><a id=menu-toggle class=icon href=# onclick='return $("#nav-footer").toggle(),!1' aria-label=Menu><i class="fas fa-bars fa-lg" aria-hidden=true></i> Menu</a>
<a id=toc-toggle class=icon href=# onclick='return $("#toc-footer").toggle(),!1' aria-label=TOC><i class="fas fa-list fa-lg" aria-hidden=true></i> TOC</a>
<a id=share-toggle class=icon href=# onclick='return $("#share-footer").toggle(),!1' aria-label=Share><i class="fas fa-share-alt fa-lg" aria-hidden=true></i> share</a>
<a id=top style=display:none class=icon href=# onclick='$("html, body").animate({scrollTop:0},"fast")' aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg" aria-hidden=true></i> Top</a></div></div></div><footer id=footer><div class=footer-left>Copyright &copy; 2022 Greycode's Blog</div><div class=footer-right><nav><ul><li><a href=/>Home</a></li><li><a href=/posts>All posts</a></li><li><a href=/categories>Categories</a></li><li><a href=/tags>Tags</a></li></ul></nav></div></footer></div></body><link rel=stylesheet href=/lib/font-awesome/css/all.min.css><script src=/lib/jquery/jquery.min.js></script>
<script src=/js/main.js></script>
<script src=/js/code-copy.js></script>
<script>MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]]},svg:{fontCache:"global"}}</script><script type=text/javascript id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script></html>